apiVersion: apps/v1beta2
kind: DaemonSet
metadata:
  name: fail2ban
spec:
  selector:
    matchLabels:
      app: fail2ban
      chart: {{ .Chart.Name }}
  template:
    metadata:
      labels:
        app: fail2ban
        chart: {{ .Chart.Name }}
    spec:
      containers:
      - env:
        - name: F2B_IPTABLES_CHAIN
          value: INPUT
        image: crazymax/fail2ban:latest
        imagePullPolicy: Always
        name: fail2ban
        securityContext:
          capabilities:
            add:
            - NET_ADMIN
            - NET_RAW
        volumeMounts:
        - mountPath: /data/jail.d
          name: jailsd
          readOnly: true
        - mountPath: /data/filter.d
          name: filterd
          readOnly: true
        - mountPath: /host/var/log
          name: hostlogs
          readOnly: true
        - mountPath: /data/db
          name: statedb
      volumes:
      - configMap:
          defaultMode: 292
          name: jails
          optional: false
        name: jailsd
      - configMap:
          defaultMode: 292
          name: filters
          optional: false
        name: filterd
      - hostPath:
          path: /var/log
          type: ""
        name: hostlogs
      - hostPath:
          path: /tmp/kube-fail2ban/db
          type: ""
        name: statedb
